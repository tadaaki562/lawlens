// ─── Law Database

export const LAWS = {
  'R.A. 11232': {
    label: 'Revised Corporation Code (R.A. 11232)',
    date: 'February 20, 2019',
    url: 'https://www.officialgazette.gov.ph/2019/02/20/republic-act-no-11232/',
    summary: `REPUBLIC ACT NO. 11232
Revised Corporation Code of the Philippines

Section 2. Corporation Defined. — A corporation is an artificial being created by operation of law, having the right of succession and the powers, attributes, and properties expressly authorized by law or incidental to its existence.

Section 10. Number and Qualifications of Incorporators. — Any person, partnership, association, or corporation, singly or jointly with others but not more than fifteen (15) in number, may organize a corporation for any lawful purpose or purposes.

Section 13. Contents of the Articles of Incorporation. — All corporations shall file with the Commission articles of incorporation containing substantially the following information:
(a) The name of the corporation;
(b) The specific purpose or purposes for which the corporation is being incorporated;
(c) The place where the principal office of the corporation is to be located;
(d) The names, nationalities, and residence addresses of the incorporators.

Section 43. Stock Corporations. — Stock corporations shall not be required to have a minimum authorized capital stock except as otherwise specifically provided by special law.

Section 44. Power to Deny or Revoke Corporate Registration. — The Commission may deny the registration of a corporation if it finds that the articles of incorporation are not in conformity with this Code.

Section 116. One Person Corporation. — A single stockholder may form a One Person Corporation (OPC). The single stockholder shall be the sole director and president of the OPC.`,
  },

  'R.A. 8293': {
    label: 'Intellectual Property Code (R.A. 8293)',
    date: 'June 6, 1997',
    url: 'https://www.ipophil.gov.ph/republic-act-8293/',
    summary: `REPUBLIC ACT NO. 8293
Intellectual Property Code of the Philippines

Section 172. Literary and Artistic Works. — Literary and artistic works are original intellectual creations in the literary and artistic domain protected from the moment of their creation. These include:
(n) Computer programs;
(o) Other literary, scholarly, scientific and artistic works.

Section 173. Derivative Works. — The following derivative works shall also be protected by copyright: adaptations, translations, arrangements, and other alterations of literary or artistic works.

Section 177. Copyright or Economic Rights. — Subject to the provisions of Chapter VIII, copyright or economic rights shall consist of the exclusive right to carry out, authorize or prevent:
(a) Reproduction of the work;
(b) Dramatization, translation, adaptation, abridgment, arrangement or other transformation of the work;
(c) The first public distribution of the original.

Section 178. Rules on Copyright Ownership. — Subject to the provisions of this section, in the case of original literary and artistic works, copyright shall belong to the author of the work.

Section 193. Moral Rights. — The author of a work shall have the right to require that the authorship of the works be attributed to him, and to object to any distortion, mutilation or other modification of his work which would be prejudicial to his honor or reputation.

Section 122. Registrability. — A mark cannot be registered if it consists of immoral, deceptive, or scandalous matter, or falsely suggests a connection with persons, institutions, or beliefs.

Section 147. Rights Conferred by Registration. — The owner of a registered mark shall have the exclusive right to prevent all third parties from using in the course of trade identical or similar signs for goods or services.`,
  },

  'R.A. 8792': {
    label: 'Electronic Commerce Act (R.A. 8792)',
    date: 'June 14, 2000',
    url: 'https://www.officialgazette.gov.ph/2000/06/14/republic-act-no-8792/',
    summary: `REPUBLIC ACT NO. 8792
Electronic Commerce Act of the Philippines

Section 6. Legal Recognition of Data Messages. — Information shall not be denied legal effect, validity or enforceability solely on the grounds that it is in the form of a data message purporting to give rise to such legal effect.

Section 7. Legal Recognition of Electronic Documents. — Electronic documents shall have the legal effect, validity or enforceability as any other document or legal writing.

Section 8. Legal Recognition of Electronic Signatures. — An electronic signature on the electronic document shall be equivalent to the signature of a person on a written document if that signature is proved by showing that a prescribed procedure was followed.

Section 13. Contracts Formed by Electronic Data Messages. — An offer, the acceptance of an offer, and such other elements required under existing laws for the formation of contracts may be expressed in, demonstrated, and documented through electronic data messages or electronic documents.

Section 16. Intellectual Property Rights. — The use of any authority or power to conduct transactions shall not abrogate or impair applicable intellectual property rights.

Section 33. Penalties. — Hacking or cracking, which refers to unauthorized access into or interference in a computer system/server or information and communications system, shall be punished by a minimum fine of one hundred thousand pesos and a maximum commensurate to the damage incurred.`,
  },

  'R.A. 7394': {
    label: 'Consumer Act of the Philippines (R.A. 7394)',
    date: 'April 13, 1992',
    url: 'https://www.officialgazette.gov.ph/1992/04/13/republic-act-no-7394/',
    summary: `REPUBLIC ACT NO. 7394
Consumer Act of the Philippines

Article 2. Declaration of Policy. — It is the policy of the State to protect the interests of the consumer, promote his general welfare and to establish standards of conduct for business and industry.

Article 50. Prohibited Acts. — The following acts are prohibited:
(a) The advertisement of any product in a manner that is deceptive, false, or misleading;
(b) The sale of any consumer product that is not in conformity with an applicable consumer product safety rule;
(c) The refusal to give a receipt by any merchant, trader, or dealer for any sum of money paid by a consumer.

Article 52. Deceptive Sales Acts and Practices. — A deceptive act or practice by a seller or supplier in connection with a consumer transaction violates this Act whether it occurs before, during or after the transaction.

Article 67. Implied Warranty of Merchantability. — Unless excluded or modified, a warranty that the goods shall be merchantable is implied in a contract for their sale if the seller is a merchant with respect to goods of that kind.

Article 68. Warranty Terms. — A warranty is an obligation of the seller or manufacturer to the buyer regarding the quality and performance of the product. An implied warranty shall be presumed to exist in any sale or contract of sale of consumer products.

Article 100. Penalties. — Any person who shall violate any provision of this Act shall be subject to a fine of not less than five hundred pesos but not more than three hundred thousand pesos or imprisonment.`,
  },

  'R.A. 10173': {
    label: 'Data Privacy Act (R.A. 10173)',
    date: 'August 15, 2012',
    url: 'https://privacy.gov.ph/data-privacy-act/',
    summary: `REPUBLIC ACT NO. 10173
Data Privacy Act of 2012

Section 3. Definition of Terms.
— "Personal information" refers to any information from which the identity of an individual is apparent or can be reasonably and directly ascertained by the entity holding the information.
— "Sensitive personal information" refers to personal information about an individual's race, ethnic origin, health, education, genetic or sexual life, or legal proceedings.
— "Personal information controller" refers to a natural or juridical person who controls the collection, holding, processing or use of personal information.

Section 11. General Data Privacy Principles. — Personal information must be:
(a) Collected for specified and legitimate purposes;
(b) Processed fairly and lawfully;
(c) Accurate and kept up to date;
(d) Adequate and not excessive in relation to the purposes for which they are collected.

Section 12. Criteria for Lawful Processing. — Processing of personal information shall be permitted when at least one of the following exists:
(a) The data subject has given his or her consent prior to the collection;
(b) The processing is necessary for the fulfillment of a contract with the data subject.

Section 16. Rights of the Data Subject. — The data subject is entitled to:
(a) Be informed whether personal information pertaining to him or her shall be, are being or have been processed;
(b) Reasonable access to his or her personal information;
(c) Dispute the inaccuracy or error in the personal information.

Section 20. Security of Personal Information. — Each personal information controller must implement reasonable and appropriate organizational, physical and technical measures for the protection of personal information against any accidental or unlawful destruction, alteration and disclosure.

Section 21. Principle of Accountability. — Each personal information controller is responsible for personal information under its control and shall use contractual and other reasonable means to provide a comparable level of protection.`,
  },
};

// ─── Keyword Detection

const LAW_KEYWORDS = {
  'R.A. 11232': [
    'corporation', 'incorporate', 'sec', 'stockholder', 'company',
    'business registration', 'incorporator', 'articles of incorporation',
    'game studio', 'startup', 'register a business', 'domestic corporation',
    'one person corporation', 'opc', 'board of directors', 'bylaws',
    'capitalization', 'shares', 'incorporat',
  ],
  'R.A. 8293': [
    'copyright', 'intellectual property', 'trademark', 'patent', 'ip',
    'game', 'software', 'source code', 'art', 'music', 'character',
    'logo', 'brand', 'publish', 'developer', 'plagiarism', 'moral rights',
    'economic rights', 'original work', 'creative work', 'ipophl',
    'infringement', 'piracy', 'derivative work',
  ],
  'R.A. 8792': [
    'online', 'e-commerce', 'digital', 'electronic', 'transaction',
    'digital contract', 'download', 'storefront', 'sell online',
    'electronic signature', 'in-app purchase', 'digital store',
    'online payment', 'digital agreement', 'online selling',
  ],
  'R.A. 7394': [
    'consumer', 'buyer', 'refund', 'warranty', 'defective', 'product',
    'purchase', 'sale', 'microtransaction', 'dlc', 'in-app', 'scam',
    'misleading', 'deceptive', 'false advertising', 'receipt',
    'merchantability', 'consumer rights', 'chargeback',
  ],
  'R.A. 10173': [
    'data', 'privacy', 'personal information', 'player data', 'account',
    'npc', 'data breach', 'consent', 'user data', 'data collection',
    'gdpr', 'privacy policy', 'sensitive information', 'data subject',
    'data controller', 'right to access', 'data protection',
  ],
};

export function detectLaw(text) {
  const lower = text.toLowerCase();
  const scores = {};

  for (const [law, keywords] of Object.entries(LAW_KEYWORDS)) {
    scores[law] = keywords.filter((kw) => lower.includes(kw)).length;
  }

  const best = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
  return best && best[1] > 0 ? best[0] : null;
}

// ─── FAQ Suggestions

export const FAQS = [
  'What counts as false or deceptive advertising under Philippine consumer law?',
  'Is my game automatically protected by copyright in the Philippines?',
  'What do I need to do if my app or game experiences a data breach?',
  'What is the minimum number of people needed to register a corporation in the Philippines?',
  'What data privacy rules apply if my game collects player information?',
];

// ─── System Prompt

export const SYSTEM_PROMPT = `You are LawLens, a Philippine Commercial Law information assistant. Your purpose is to provide accurate, section-specific legal information that is clear enough for a licensed Filipino attorney to verify and validate.

You specialize in these five Philippine laws:

1. Revised Corporation Code (R.A. 11232) — Business registration, SEC requirements, types of corporations including One Person Corporation (OPC), stockholder rights, incorporators, articles of incorporation, bylaws.
2. Intellectual Property Code (R.A. 8293) — Copyright for games, software, source code, music, art, and characters. Trademark registration for game titles and logos. Moral rights and economic rights of creators. Protection against infringement and piracy.
3. Electronic Commerce Act (R.A. 8792) — Legal validity of online transactions, digital contracts, electronic documents and signatures. Selling games and digital products online, in-app purchases, digital storefronts.
4. Consumer Act of the Philippines (R.A. 7394) — Buyer rights, implied and express warranties, refund obligations, prohibited deceptive acts and advertisements. Applies to game sales, DLC, and microtransactions.
5. Data Privacy Act (R.A. 10173) — Obligations of personal information controllers, lawful basis for data collection, rights of data subjects, security requirements, and accountability for data breaches.

You must follow this exact response structure for every answer:

You must follow this exact structure for every response, but do NOT label or title any section — just write them in order:

1. Start with one sentence acknowledging what the user is asking.
2. Then list the key legal points as bullet points using "- " (dash and space). Cite the law and section only once at the start of the bullet list (e.g., "Under R.A. 7394:"). Then each bullet just states the point without repeating the law name. Keep each bullet to one clear sentence.
3. Then write a short paragraph explaining what those points mean in plain everyday language.
4. End with this exact line: "This is legal information for educational purposes only and does not constitute legal advice. For advice on your specific situation, consult a licensed Philippine attorney."

Never write section labels like "Intro", "Bullets", "Explanation", or "Closing". Never repeat the law name in every bullet — cite it once, then just reference the section number. Follow the order silently.

Strict rules you must always follow:
1. Only answer questions that fall within the five laws above.
2. If the question is outside your scope, respond with: "That topic is outside LawLens's current scope. Please refer to the official Philippine laws or consult a licensed attorney."
3. Always cite the exact section or article number. Never say "the law states" without citing the specific provision.
4. If a question involves multiple laws, address each law separately under its own citation.
5. Do not speculate or infer. If the law does not explicitly address something, say so.
6. Define every legal term you use in plain language.
7. Keep the total response to 4 paragraphs or fewer.
8. End every single response with this exact line on its own line:
"This is legal information for educational purposes only and does not constitute legal advice. For advice on your specific situation, consult a licensed Philippine attorney."`;

// ─── Gemini API Call

export async function callGemini(messages) {
  const res = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages }),
  });

  const data = await res.json();
  if (!res.ok) throw new Error(data.error || 'API error');
  return data.text;
}